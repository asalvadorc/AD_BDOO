<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://asalvadorc.github.io/AD_BDOO/exercicis/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>2 - Exercicis - AD - Accés a Dades</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "2 - Exercicis";
        var mkdocs_page_input_path = "exercicis.md";
        var mkdocs_page_url = "/AD_BDOO/exercicis/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="..">
          <img src="../assets/logocaminas.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">UD 4. BD Orientades a Objectes</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../3__bases_de_dades_orientades_a_objectes/">1 - Les Bases de Dades Orientades a Objectes</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">2 - Exercicis</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#exercici-61">Exercici 6.1</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#exercici-62">Exercici 6.2</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#exercici-63-voluntari">Exercici 6.3 (voluntari)</a>
    </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">AD - Accés a Dades</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">UD 4. BD Orientades a Objectes</li>
      <li class="breadcrumb-item active">2 - Exercicis</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="exercicis">Exercicis</h1>
<h2 id="exercici-61"><img alt="" src="../icon_activity.gif" /> Exercici 6.1</h2>
<p>Crea un nou paquet anomenat <strong>exercicis</strong> en el projecte <strong>Tema6</strong>. Incorpora
en el projecte el driver per a <strong>DB4O</strong> , sino el tenies incorporat.</p>
<ul>
<li>Copia el paquet <strong>util.bd</strong> al projecte. Aquest paquet el vam fer en l'exercici <strong>T4Ex4</strong> i inclou les classes <strong>Coordenades.kt</strong> , <strong>PuntGeo.kt</strong> i <strong>Ruta.kt</strong>. També inclou la classe <strong>GestionarRutesBD.java</strong> , que ens permetia gestionar la BD <strong>Rutes.sqlite</strong></li>
<li>Copia també la BD <strong>Rutes.sqlite</strong> , creada en exercicis anteriors, però que l'última actualització és del mateix exercici.</li>
<li>Incorpora el driver de SQLite</li>
<li>Hem de canviar la definició de les propietats de la classe <strong>Ruta</strong> , ja que ara hem de permetre valors nuls per a poder fer consultes pel mètode <strong>queryByExample()</strong>. La manera més senzilla segurament serà:</li>
</ul>
<pre><code>    class Ruta (var nom: String?, var desnivell: Int?, var desnivellAcumulat: Int?, var llistaDePunts: MutableList&lt;PuntGeo&gt; = mutableListOf&lt;PuntGeo&gt;()): Serializable 
</code></pre>
<ul>
<li>D'aquesta manera, per a crar un objecte <strong>Ruta</strong> que estiga totalment buit, ho faríem així: <strong>Ruta(null,null,null)</strong></li>
<li>Podria ser que aquest canvi en la definició de les propietat de <strong>Ruta</strong> provoque algun error en <strong>GestionarRutesBD</strong>. Si és així corregeix-los</li>
</ul>
<p>A partir d'aci comença realment l'exercici, que consistirà en passar les dades
des de <strong>Rutes.sqlite</strong> fins la Base de Dades de <strong>DB4O</strong> <strong>Rutes.db4o</strong>.</p>
<ul>
<li>Crea't el programa <strong>Ex1_PassarRutaSqliteDB4O.kt</strong>. <ul>
<li>Has d'agafar totes les rutes de Rutes.sqlite i deixar-les en un ArrayList de Ruta amb el mètode ja creat de <strong>GestionarRutesBD.java</strong> anomenat <strong>llistat()</strong>.</li>
<li>Insereix totes les rutes en la BD <strong>Rutes.db4o</strong>.</li>
<li>Tanca la connexió.</li>
</ul>
</li>
<li>Crea't el programa <strong>Ex1_VisRutaDB4O.kt</strong> , que ha de connectar a la Base de Dades <strong>Rutes.db4o</strong> , ha de llegir totes les rutes (ves amb compte, perquè només has de llegir rutes; s'han guardat més objectes: punts i coordenades) i ha de traure per pantalla el nom de la ruta i el número de punts.</li>
</ul>
<blockquote>
<blockquote>
<blockquote>
<p><img alt="" src="../T6_Ex_3_1.png" /></p>
</blockquote>
</blockquote>
</blockquote>
<h2 id="exercici-62"><img alt="" src="../icon_activity.gif" /> Exercici 6.2</h2>
<p>En el mateix projecte i paquet anem a fer una aplicació amb interfície
gràfica atancant a DB4O.</p>
<p>El programa mostrarà una ruta, i hi haurà també uns botons per anar a la
primera, anterior, següent i última ruta. Hi ha també el botó de Tancar, que
tancarà la connexió amb la Base de Dades i eixirà del programa.</p>
<p>Per a omplir el JTable amb els punts, teniu un mètode que ho fa
automàticament: <strong>plenarTaula()</strong>. Observeu quin és el seu paràmetre.</p>
<p>De moment tindrà aquest aspecte:</p>
<p><img alt="Exercici4_1" src="../T6_4_1.png" /></p>
<p>en el qual, a banda de les etiquetes (<strong>JLabel</strong>) i quadres de text
(<strong>JTextField</strong>) tenim una taula (<strong>JTable</strong>) on col·locarem tots els punts de
la ruta (nom, latitud i longitud). Tots els controls són no editables, per a
no poder introduir cap informació.</p>
<p>Aquest seria l'esquelet del programa.</p>
<p>Copieu-lo en un fitxer Kotlin anomenat <strong>Ex2_VisRutes_DB4O.kt</strong> , i poseu les
sentències necessàries després dels comentaris:</p>
<pre><code>import java.awt.EventQueue
import java.awt.GridLayout
import java.awt.FlowLayout
import javax.swing.JFrame
import javax.swing.JPanel
import javax.swing.BoxLayout
import javax.swing.JComboBox
import javax.swing.JButton
import javax.swing.JTextArea
import javax.swing.JLabel
import javax.swing.JTextField
import javax.swing.JTable
import javax.swing.JScrollPane

import util.bd.Ruta
import util.bd.PuntGeo
import com.db4o.Db4oEmbedded

class FinestraComplet : JFrame() {
    var llista = arrayListOf&lt;Ruta&gt;()
    var numActual = 0

    // Declaració de la Base de Dades

    val qNom = JTextField(15)
    val qDesn = JTextField(5)
    val qDesnAcum = JTextField(5)
    val punts = JTable(1, 3)
    val primer = JButton(" &lt;&lt; ")
    val anterior = JButton(" &lt; ")
    val seguent = JButton(" &gt; ")
    val ultim = JButton(" &gt;&gt; ")
    val tancar = JButton("Tancar")

    init {
        defaultCloseOperation = JFrame.EXIT_ON_CLOSE
        setTitle("JDBC: Visualitzar Rutes Complet")
        setLayout(GridLayout(0, 1))

        val p_prin = JPanel()
        p_prin.setLayout(BoxLayout(p_prin, BoxLayout.Y_AXIS))
        val panell1 = JPanel(GridLayout(0, 2))
        panell1.add(JLabel("Ruta:"))
        qNom.setEditable(false)
        panell1.add(qNom)
        panell1.add(JLabel("Desnivell:"))
        qDesn.setEditable(false)
        panell1.add(qDesn)
        panell1.add(JLabel("Desnivell acumulat:"))
        qDesnAcum.setEditable(false)
        panell1.add(qDesnAcum)
        panell1.add(JLabel("Punts:"))

        val panell2 = JPanel(GridLayout(0, 1))
        punts.setEnabled(false)
        val scroll = JScrollPane(punts)
        panell2.add(scroll, null)

        val panell5 = JPanel(FlowLayout())
        panell5.add(primer)
        panell5.add(anterior)
        panell5.add(seguent)
        panell5.add(ultim)

        val panell6 = JPanel(FlowLayout())
        panell6.add(tancar)

        add(p_prin)
        p_prin.add(panell1)
        p_prin.add(panell2)
        p_prin.add(panell5)
        p_prin.add(panell6)
        pack()

        primer.addActionListener {
            // instruccions per a situar-se en la primera ruta, i visualitzar-la

        }
        anterior.addActionListener {
            // instruccions per a situar-se en la ruta anterior, i visualitzar-la

        }
        seguent.addActionListener {
            // instruccions per a situar-se en la ruta següent, i visualitzar-la

        }
        ultim.addActionListener {
            // instruccions per a situar-se en l'últim ruta, i visualitzar-la

        }
        tancar.addActionListener {
            // instruccions per a tancar la BD i el programa

        }

        inicialitzar()
        VisRuta()
    }

    fun plenarTaula(ll_punts: MutableList&lt;PuntGeo&gt;) {
        var ll = Array(ll_punts.size) { arrayOfNulls&lt;String&gt;(3) }
        for (i in 0 until ll_punts.size) {
            ll[i][0] = ll_punts.get(i).nom
            ll[i][1] = ll_punts.get(i).coord.latitud.toString()
            ll[i][2] = ll_punts.get(i).coord.longitud.toString()
        }
        val caps = arrayOf("Nom punt", "Latitud", "Longitud")
        punts.setModel(javax.swing.table.DefaultTableModel(ll, caps))
    }

    fun inicialitzar() {
        // instruccions per a inicialitzar llista i numActual

    }

    fun VisRuta() {
        // instruccions per a visualitzar la ruta actual (l'índex el tenim en numActual

        ActivarBotons()
    }

    fun ActivarBotons() {
        // instruccions per a activar o desactivar els botons de moviment ( setEnabled(Boolean) )

    }

}

fun main(args: Array&lt;String&gt;) {
    EventQueue.invokeLater {
        FinestraComplet().isVisible = true
    }
}
</code></pre>
<h2 id="exercici-63-voluntari"><img alt="" src="../icon_activity.gif" /> Exercici 6.3 (voluntari)</h2>
<p>Modificar la classe anterior per a incorporar també la <strong>distància total de la
ruta</strong>. Per a poder calcular-la ens ajudarem de la següent funció que calcula
la distància en quilòmetres entre dos punts, donant les coordenades (latitud i
longitud) dels dos punts: <strong>Dist(lat1,long1,lat2,long2)</strong>. Observeu que per a
calcular la distància de forma correcta hem de tenir en compte tots els punts
(si només tenim en compte el primer punt i l'últim, la distància d'una ruta
circular seria 0).</p>
<p>Podeu incorporar-la a la classe on esteu fent l'exercici
(<strong>Ex2_VisRutes_DB4O.kt</strong>).</p>
<pre><code>fun Dist(lat1: Double, lon1: Double, lat2: Double, lon2: Double): Double {

    val R = 6378.137 // Radi de la Tierra en km
    val dLat = rad(lat2 - lat1)
    val dLong = rad(lon2 - lon1)

    val a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(rad(lat1)) * Math.cos(rad(lat2)) * Math.sin(dLong / 2) * Math.sin(dLong / 2)
    val c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))
    val d = R * c
    return Math.round(d*100.0)/100.0
}

fun rad(x: Double): Double {
    return x * Math.PI / 180
}
</code></pre>
<p>Aquest seria un exemple:</p>
<p><img alt="" src="../T6_Ex_5_1.png" /></p>
<p>Llicenciat sota la  <a href="http://creativecommons.org/licenses/by-nc-sa/2.5/">Llicència Creative Commons Reconeixement NoComercial
CompartirIgual 2.5</a></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../3__bases_de_dades_orientades_a_objectes/" class="btn btn-neutral float-left" title="1 - Les Bases de Dades Orientades a Objectes"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../3__bases_de_dades_orientades_a_objectes/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
